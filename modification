-- 1) Désactiver les contraintes FK
EXEC sp_MSforeachtable 'ALTER TABLE ? NOCHECK CONSTRAINT ALL';

-- 2) Générer les TRUNCATE TABLE pour toutes les tables utilisateurs
DECLARE @sql NVARCHAR(MAX) = N'';

SELECT @sql = STRING_AGG(
    'TRUNCATE TABLE ' + QUOTENAME(s.name) + '.' + QUOTENAME(t.name) + ';',
    CHAR(10)
)
FROM sys.tables t
JOIN sys.schemas s ON s.schema_id = t.schema_id
WHERE t.is_ms_shipped = 0;  -- éviter les tables système

-- Exécuter les TRUNCATE
EXEC sp_executesql @sql;

-- 3) Réactiver les contraintes FK
EXEC sp_MSforeachtable 'ALTER TABLE ? WITH CHECK CHECK CONSTRAINT ALL';