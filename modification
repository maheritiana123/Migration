public void PerformMigration()
{
    GetAllTables();

    BeginTransaction();
    try
    {
        Console.WriteLine("=== üì§ Import des tables m√®res ===");
        foreach (var table in SortTablesByDependencies(_importOrder))
            ImportTableCommon(table);

        Console.WriteLine("=== üì§ Import des relations pures ===");
        foreach (var table in SortTablesByDependencies(_pureRelations))
            ImportTableCommon(table);

        Console.WriteLine("=== üì§ Import des relations √©tendues ===");
        foreach (var table in SortTablesByDependencies(_extendedRelations))
            ImportTableCommon(table);

        CommitTransaction();
        Console.WriteLine("‚úÖ Migration termin√©e avec succ√®s !");
    }
    catch (Exception ex)
    {
        Console.WriteLine($"‚ùå Erreur critique lors de la migration : {ex.Message}");
        RollbackTransaction();
    }
}
private List<string> SortTablesByDependencies(List<string> tables)
{
    var sorted = new List<string>();
    var visited = new HashSet<string>();

    void Visit(string table)
    {
        if (visited.Contains(table))
            return;

        visited.Add(table);

        var fks = GetForeignKeyInfo(table)
            .Where(fk => tables.Contains(fk.ReferencedTableName))
            .Select(fk => fk.ReferencedTableName)
            .Distinct();

        foreach (var dep in fks)
            Visit(dep);

        sorted.Add(table);
    }

    foreach (var table in tables)
        Visit(table);

    return sorted;
}
