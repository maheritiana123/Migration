LoadRelationTables(); // appelle cette méthode juste après avoir désactivé les contraintes

var (dependencies, allCircularRefs) = AnalyzeDatabaseStructure();
var importOrder = GetImportOrderExcludingCircular(dependencies, allCircularRefs);

// 1. Importer les tables normales (non-relationnelles)
foreach (var table in importOrder)
{
    if (_pureRelations.Contains(table) || _extendedRelations.Contains(table))
        continue; // cette table sera traitée dans la partie relation

    if (_importedTables.Contains(table)) continue;
    _importedTables.Add(table);

    Console.WriteLine($"Import de {table}");
    ImportTable(table);
}

// 2. Importer les tables de relations PURES
foreach (var table in _pureRelations)
{
    if (_importedTables.Contains(table)) continue;
    _importedTables.Add(table);

    Console.WriteLine($"Import de la relation pure {table}");
    ImportPureRelationTable(table);
}

// 3. Importer les tables de relations ÉTENDUES
foreach (var table in _extendedRelations)
{
    if (_importedTables.Contains(table)) continue;
    _importedTables.Add(table);

    Console.WriteLine($"Import de la relation étendue {table}");
    ImportExtendedRelationTable(table);
}


foreach (var table in _pureRelations.Concat(_extendedRelations))
{
    if (_importedTables.Contains(table)) continue;
    _importedTables.Add(table);

    if (_extendedRelations.Contains(table))
    {
        Console.WriteLine($"Import de la relation étendue {table}");
        ImportExtendedRelationTable(table);
    }
    else
    {
        Console.WriteLine($"Import de la relation pure {table}");
        ImportPureRelationTable(table);
    }
}