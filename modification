# Check-SystemSize.ps1
# Script pour mesurer les gros dossiers "système" qui peuvent gonfler

$report = @()

function Get-FolderSizeGB($path) {
    if (Test-Path $path) {
        $size = (Get-ChildItem $path -Recurse -Force -ErrorAction SilentlyContinue | Measure-Object Length -Sum).Sum
        if ($size) {
            return [math]::Round($size / 1GB, 2)
        } else {
            return 0
        }
    } else {
        return "Introuvable"
    }
}

$folders = @(
    "C:\Windows\SoftwareDistribution",
    "C:\ProgramData\Microsoft\Windows\DeliveryOptimization",
    "C:\System Volume Information"
)

foreach ($f in $folders) {
    $size = Get-FolderSizeGB $f
    $report += [PSCustomObject]@{
        Dossier = $f
        Taille_GB = $size
    }
}

# Affiche le rapport dans la console
$report | Format-Table -AutoSize

# Sauvegarde aussi sur le bureau
$desktop = [Environment]::GetFolderPath("Desktop")
$report | Out-File -FilePath "$desktop\SystemSizeReport.txt" -Encoding UTF8

Write-Host "`nRapport enregistré sur le bureau : SystemSizeReport.txt" -ForegroundColor Green